<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Web Project Fixed Layout</title>
    <style>
        /* --- CSS RESET & BASE --- */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            user-select: none; -webkit-user-drag: none;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%; height: 100%; overflow: hidden; background-color: #000;
        }

        /* --- BACKGROUND & LAYOUT --- */
        #background-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('BACKGROUND (1).webp');
            background-size: cover; background-position: center; z-index: 0;
        }

        #game-container {
            position: absolute; top: 50%; left: 50%;
            width: 1920px; height: 1080px;
            transform-origin: center center; z-index: 1;
        }

        /* --- UTILITY --- */
        .absolute-img { position: absolute; display: block; pointer-events: auto; }
        .absolute-center-img {
            position: absolute; display: block;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .clickable-btn { cursor: pointer; transition: transform 0.1s ease, filter 0.1s ease; }
        .clickable-btn:hover { transform: scale(1.05); filter: brightness(1.1); }
        .clickable-btn:active { transform: scale(0.95); }

        /* --- ANIMATIONS --- */
        @keyframes slideUpNormal { from { opacity: 0; transform: translateY(100px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUpCenter { from { opacity: 0; transform: translate(-50%, -50%) translateY(100px); } to { opacity: 1; transform: translate(-50%, -50%) translateY(0); } }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

        .anim-normal { animation: slideUpNormal 0.8s ease-out forwards; }
        .anim-center { animation: slideUpCenter 0.8s ease-out forwards; }

        /* --- PAGES --- */
        
        /* 1. LANDING PAGE */
        #landing-page { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; transition: opacity 0.5s ease; }
        #bg-open { left: 249.4px; top: 127.1px; animation: slideUpNormal 0.8s ease-out forwards; opacity: 0; }
        #judul { left: 478.8px; top: 239.6px; animation: slideUpNormal 0.8s ease-out 0.3s forwards; opacity: 0; }
        #btn-play { left: 795.1px; top: 530px; animation: slideUpNormal 0.8s ease-out 0.6s forwards, pulsePlay 2s infinite ease-in-out 1.5s; opacity: 0; }

        /* 2. STAGE PAGE */
        #stage-page { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; z-index: 5; transition: opacity 0.5s ease; }
        .stage-element { opacity: 0; }
        #stage-book { z-index: 2; }
        #stage-track { z-index: 3; left: 430.8px; top: 378px; }
        .stage-top-layer { z-index: 4; }
        #text-c1 { left: 430.8px; top: 234.2px; }
        #text-c2 { left: 339.2px; top: 742.9px; }
        #text-c3 { left: 1251px; top: 186.4px; }
        #text-wp { left: 1062.2px; top: 700.9px; }
        #btn-c1 { left: 357.2px; top: 366.2px; }
        #btn-c2 { left: 650.9px; top: 643.2px; }
        #btn-c3 { left: 1109.7px; top: 312.5px; }
        #btn-prize { left: 1318.8px; top: 486.5px; }

        /* 3. CHALLENGE 1 PAGE */
        #challenge1-page { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; z-index: 15; }
        
        /* Intro C1 */
        #c1-intro { z-index: 20; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }

        /* Wadah Konten Spinning (Spinning Time) */
        #c1-content { opacity: 0; width: 100%; height: 100%; position: relative; transition: opacity 0.5s ease; }

        #text-st { position: absolute; left: 50%; top: 200px; transform: translateX(-50%); width: 600px; height: auto; z-index: 5; }
        
        /* Spinner Components */
        #spinner-wrapper {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 1200px; height: 350px; background: transparent; border: none; overflow: hidden;
        }
        #spinner-selector {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 4px; height: 100%; background: #FF0000; z-index: 10; box-shadow: 0 0 10px red;
        }
        #spinner-track { display: flex; align-items: center; height: 100%; position: absolute; left: 0; top: 0; will-change: transform; }
        .spin-item {
            width: 200px; height: 200px; margin: 0 10px; background-color: rgba(255,255,255,0.1);
            border-radius: 10px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .spin-item img { width: 100%; height: 100%; object-fit: contain; }
        
        #btn-spin-img {
            position: absolute; bottom: 150px; left: 50%; transform: translateX(-50%);
            width: 200px; height: auto; z-index: 20; cursor: pointer; transition: transform 0.1s;
        }
        #btn-spin-img:hover { transform: translateX(-50%) scale(1.1); }

        /* --- ELIMINATION PHASE --- */
        #elimination-phase {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; /* Flex diaktifkan via JS */
            flex-direction: row; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.5s ease; z-index: 10;
        }

        /* Container Grid Kiri */
        #grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            gap: 20px; 
            margin-right: 50px; 
            background: transparent; 
            padding: 20px;
        }

        .grid-f-item {
            width: 180px; height: 180px; 
            position: relative; 
            transition: transform 0.2s;
            display: flex; justify-content: center; align-items: center;
        }
        .grid-f-item img.main-img { width: 100%; height: 100%; object-fit: contain; }
        .grid-f-item:hover { transform: scale(1.05); }

        /* Hover Actions (Buttons) */
        .item-actions {
            position: absolute; 
            top: 45px; /* Kebawah dikit */
            right: 0px; 
            display: none; 
            flex-direction: row; gap: 5px; z-index: 10;
        }
        .grid-f-item:hover .item-actions { display: flex; }

        .action-btn {
            width: 50px; height: 50px; 
            cursor: pointer; transition: transform 0.1s;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }
        .action-btn:hover { transform: scale(1.1); filter: brightness(1.2); }
        .action-btn:active { transform: scale(0.9); }

        /* Reference Panel Kanan (Flex Column) */
        #picked-reference {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin-left: 50px;
            gap: 15px; /* Jarak antar elemen vertikal */
        }
        
        /* Tombol Back */
        #btn-back-c1 {
            width: 300px; height: auto; cursor: pointer;
            transition: transform 0.1s;
            margin-bottom: 10px;
        }
        #btn-back-c1:hover { transform: scale(1.05); }

        /* Header Gambar F-PICKED OP */
        #picked-op-img {
            width: 450px; height: auto; object-fit: contain;
        }

        /* Gambar Kartu */
        #picked-img {
            width: 450px; height: 450px; 
            object-fit: contain;
            border: none; background: transparent; box-shadow: none;
        }

        /* Info Box */
        #info-box-img {
            width: 450px; height: auto; 
        }

        /* --- OVERLAYS --- */
        .message-overlay {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            display: flex; justify-content: center; align-items: center;
            z-index: 100; cursor: pointer; opacity: 0;
            transition: opacity 0.5s ease; background: transparent;
        }

        #result-overlay {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            z-index: 200; display: none; justify-content: center; align-items: center;
            background: transparent; cursor: pointer; opacity: 0; transition: opacity 0.5s ease;
        }
        #result-img { max-width: 850px; max-height: 850px; animation: popIn 0.5s forwards; }

        /* Win Overlay (Final) */
        #win-overlay {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            z-index: 300; display: none; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.8); /* Gelap sedikit agar teks terbaca */
            cursor: pointer; opacity: 0; transition: opacity 0.5s ease;
        }
        #win-img { max-width: 1000px; animation: popIn 0.5s forwards; }

    </style>
</head>
<body>

    <div id="background-layer"></div>

    <div id="game-container">
        
        <div id="landing-page">
            <img src="BG OPEN.webp" id="bg-open" class="absolute-img">
            <img src="JUDUL.webp" id="judul" class="absolute-img">
            <img src="PLAY.webp" id="btn-play" class="absolute-img clickable-btn" onclick="startStageSequence()">
        </div>

        <div id="stage-page">
            <div id="msg-stage" class="message-overlay" onclick="closeMessage('stage')">
                <img src="MESSAGE.webp" class="absolute-center-img">
            </div>
            
            <img src="BOOK.webp" id="stage-book" class="absolute-center-img stage-element">
            <img src="TRACK.webp" id="stage-track" class="absolute-img stage-element">
            <img src="TEXT-C1.webp" id="text-c1" class="absolute-img stage-element stage-top-layer">
            <img src="TEXT-C2.webp" id="text-c2" class="absolute-img stage-element stage-top-layer">
            <img src="TEXT-C3.webp" id="text-c3" class="absolute-img stage-element stage-top-layer">
            <img src="TEXT-WP.webp" id="text-wp" class="absolute-img stage-element stage-top-layer">
            <img src="BUTTON-C1.webp" id="btn-c1" class="absolute-img clickable-btn stage-element stage-top-layer" onclick="goToChallenge1()">
            <img src="BUTTON-C2.webp" id="btn-c2" class="absolute-img clickable-btn stage-element stage-top-layer" onclick="goToChallenge2()">
            <img src="BUTTON-C3.webp" id="btn-c3" class="absolute-img clickable-btn stage-element stage-top-layer" onclick="goToChallenge3()">
            <img src="PRIZE.webp" id="btn-prize" class="absolute-img clickable-btn stage-element stage-top-layer" onclick="goToPrize()">
        </div>

        <div id="challenge1-page">
            
            <img src="C1.webp" id="c1-intro" class="absolute-center-img">

            <div id="msg-c1" class="message-overlay" onclick="closeMessage('c1')" style="display: none;">
                <img src="MESSAGE-C1.webp" class="absolute-center-img">
            </div>

            <div id="result-overlay" onclick="closeResult()">
                <img id="result-img" src="" alt="Result">
            </div>

            <div id="win-overlay" onclick="finishChallenge1()">
                <img id="win-img" src="WINTEXT-C1.webp" alt="You Win">
            </div>

            <div id="c1-content">
                <img src="TEXT-ST.webp" id="text-st" class="absolute-img">
                <div id="spinner-wrapper">
                    <div id="spinner-selector"></div>
                    <div id="spinner-track"></div>
                </div>
                <img src="SPIN.webp" id="btn-spin-img" onclick="startSpin()">
            </div>

            <div id="elimination-phase">
                
                <div id="grid-container">
                    </div>

                <div id="picked-reference">
                    <img src="BACK-C1.webp" id="btn-back-c1" onclick="backToSpin()">

                    <img src="F-PICKED OP.webp" id="picked-op-img" alt="Picked OP Header">
                    
                    <img id="picked-img" src="" alt="Picked Item">

                    <img src="INFO-C1.webp" id="info-box-img">
                </div>

            </div>

        </div>

    </div>

    <script>
        /* --- UTILS --- */
        function resizeGame() {
            const container = document.getElementById('game-container');
            const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
            container.style.transform = `translate(-50%, -50%) scale(${scale})`;
        }
        window.addEventListener('load', resizeGame);
        window.addEventListener('resize', resizeGame);

        /* --- STATE VARIABLES --- */
        let hasSpun = false;
        let pickedNumber = 0; 

        /* --- NAVIGATION --- */
        function startStageSequence() {
            const landing = document.getElementById('landing-page');
            landing.style.opacity = '0'; 
            setTimeout(() => {
                landing.style.display = 'none';
                document.getElementById('stage-page').style.display = 'block';
                setTimeout(() => document.getElementById('stage-page').style.opacity = '1', 10);
                openMessage('msg-stage');
            }, 500);
        }

        function goToChallenge1() {
            const stage = document.getElementById('stage-page');
            stage.style.opacity = '0';
            setTimeout(() => {
                stage.style.display = 'none';
                const c1Page = document.getElementById('challenge1-page');
                c1Page.style.display = 'block';

                const c1Intro = document.getElementById('c1-intro');
                c1Intro.style.opacity = '1';

                setTimeout(() => {
                    c1Intro.style.opacity = '0';
                    setTimeout(() => {
                        openMessage('msg-c1');
                        setupSpinner(); 
                    }, 500);
                }, 2000); 
            }, 500);
        }

        /* --- MESSAGE SYSTEM --- */
        function openMessage(id) {
            const msg = document.getElementById(id);
            msg.style.display = 'flex';
            setTimeout(() => { msg.style.opacity = '1'; }, 50);
        }

        function closeMessage(context) {
            let overlayId = (context === 'stage') ? 'msg-stage' : 'msg-c1';
            const msg = document.getElementById(overlayId);
            
            msg.style.opacity = '0';
            setTimeout(() => {
                msg.style.display = 'none';
                if(context === 'stage') animateStageAssetsIn();
                if(context === 'c1') animateC1AssetsIn();
            }, 500);
        }

        function animateStageAssetsIn() {
            document.getElementById('stage-book').classList.add('anim-center');
            setTimeout(() => {
                document.querySelectorAll('.stage-element:not(#stage-book)').forEach(el => el.classList.add('anim-normal'));
            }, 300);
        }

        function animateC1AssetsIn() {
            const content = document.getElementById('c1-content');
            content.style.opacity = '1'; 
        }

        /* --- SPINNING LOGIC --- */
        function setupSpinner() {
            const track = document.getElementById('spinner-track');
            track.innerHTML = ''; 
            const totalLoops = 5; const totalImages = 20;
            for (let i = 0; i < totalLoops; i++) {
                for (let j = 1; j <= totalImages; j++) {
                    const item = document.createElement('div');
                    item.className = 'spin-item';
                    const img = document.createElement('img');
                    img.src = `F${j}.webp`; 
                    item.appendChild(img);
                    track.appendChild(item);
                }
            }
        }

        function startSpin() {
            if (hasSpun) return; 
            hasSpun = true;
            document.getElementById('btn-spin-img').style.display = 'none'; 

            const track = document.getElementById('spinner-track');
            const itemWidth = 220; 
            const randomWinIndex = Math.floor(Math.random() * (95 - 75 + 1)) + 75;
            pickedNumber = (randomWinIndex % 20) + 1; 

            const containerWidth = 1200;
            const scrollPosition = (randomWinIndex * itemWidth) - (containerWidth / 2) + (itemWidth / 2);
            const randomOffset = Math.floor(Math.random() * 40) - 20; 
            const finalPosition = scrollPosition + randomOffset;

            track.style.transition = 'transform 6s cubic-bezier(0.15, 0, 0.10, 1)'; 
            track.style.transform = `translateX(-${finalPosition}px)`;

            track.addEventListener('transitionend', () => {
                showResult(pickedNumber);
            }, { once: true });
        }

        function showResult(number) {
            const resultOverlay = document.getElementById('result-overlay');
            const resultImg = document.getElementById('result-img');
            resultImg.src = `F${number}.webp`;
            
            resultOverlay.style.display = 'flex';
            resultImg.style.animation = 'none';
            resultImg.offsetHeight; 
            resultImg.style.animation = 'popIn 0.5s forwards';

            setTimeout(() => { resultOverlay.style.opacity = '1'; }, 50);
        }

        function closeResult() {
            const resultOverlay = document.getElementById('result-overlay');
            resultOverlay.style.opacity = '0';
            
            setTimeout(() => {
                resultOverlay.style.display = 'none';
                const c1Content = document.getElementById('c1-content');
                c1Content.style.opacity = '0';
                
                setTimeout(() => {
                    c1Content.style.display = 'none'; 
                    setupEliminationGrid();
                    const eliminationPhase = document.getElementById('elimination-phase');
                    eliminationPhase.style.display = 'flex'; 
                    setTimeout(() => { eliminationPhase.style.opacity = '1'; }, 50);
                }, 500);

            }, 500);
        }

        // --- ELIMINATION LOGIC ---
        function setupEliminationGrid() {
            const gridContainer = document.getElementById('grid-container');
            const pickedImg = document.getElementById('picked-img');
            
            // Set Kartu User
            pickedImg.src = `F${pickedNumber}.webp`;

            gridContainer.innerHTML = '';

            // Generate F1-F20
            for (let i = 1; i <= 20; i++) {
                const div = document.createElement('div');
                div.className = 'grid-f-item';
                div.id = `grid-item-${i}`;

                const img = document.createElement('img');
                img.src = `F${i}.webp`;
                img.className = 'main-img';
                
                const actions = document.createElement('div');
                actions.className = 'item-actions';

                // Tombol E (Eliminasi)
                const btnE = document.createElement('img');
                btnE.src = 'BUTTON-E.webp';
                btnE.className = 'action-btn';
                btnE.onclick = (e) => {
                    e.stopPropagation(); 
                    eliminateItem(div);
                };

                // Tombol R (Right/Confirm) - MENANG OTOMATIS
                const btnR = document.createElement('img');
                btnR.src = 'BUTTON-R.webp';
                btnR.className = 'action-btn';
                btnR.onclick = (e) => {
                    e.stopPropagation();
                    checkAnswer(i);
                };

                actions.appendChild(btnE);
                actions.appendChild(btnR);

                div.appendChild(img);
                div.appendChild(actions);
                gridContainer.appendChild(div);
            }
        }

        function eliminateItem(element) {
            element.style.transition = 'transform 0.3s, opacity 0.3s';
            element.style.transform = 'scale(0)';
            element.style.opacity = '0';
            setTimeout(() => {
                element.style.visibility = 'hidden';
            }, 300);
        }

        // Fungsi Cek Jawaban (Menang Instan)
        function checkAnswer(selectedNumber) {
            const winOverlay = document.getElementById('win-overlay');
            winOverlay.style.display = 'flex';
            setTimeout(() => { winOverlay.style.opacity = '1'; }, 50);
        }

        // Fungsi Klik Layar Menang -> Kembali ke Stage
        function finishChallenge1() {
            const winOverlay = document.getElementById('win-overlay');
            const c1Page = document.getElementById('challenge1-page');
            const stagePage = document.getElementById('stage-page');
            const elimPhase = document.getElementById('elimination-phase');

            // Fade Out Win Overlay
            winOverlay.style.opacity = '0';

            setTimeout(() => {
                winOverlay.style.display = 'none';
                
                // Reset/Hide Challenge 1
                elimPhase.style.display = 'none';
                c1Page.style.display = 'none';

                // Tampilkan Stage Lagi
                stagePage.style.display = 'block';
                setTimeout(() => { stagePage.style.opacity = '1'; }, 50);

                // Reset Spinner Variables (Opsional)
                hasSpun = false; 
                document.getElementById('btn-spin-img').style.display = 'block';
                document.getElementById('c1-content').style.display = 'block';
                document.getElementById('c1-content').style.opacity = '0';

            }, 500);
        }

        // Fungsi Tombol Kembali (Back to Spin) dengan LOGIKA RESET
        function backToSpin() {
            const elimPhase = document.getElementById('elimination-phase');
            const c1Content = document.getElementById('c1-content');

            elimPhase.style.opacity = '0';
            setTimeout(() => {
                elimPhase.style.display = 'none';
                
                c1Content.style.display = 'block';
                // Force reflow
                c1Content.offsetHeight; 
                c1Content.style.opacity = '1';
                
                // --- RESET LOGIC ---
                hasSpun = false;
                document.getElementById('btn-spin-img').style.display = 'block';
                
                // Reset Posisi Spinner secara visual
                const track = document.getElementById('spinner-track');
                track.style.transition = 'none'; // Matikan animasi
                track.style.transform = 'translateX(0)'; // Reset posisi
                
                // Re-build item agar animasi kemenangan hilang
                setupSpinner(); 

            }, 500);
        }

        /* Placeholder Functions */
        function goToChallenge2() { alert("Challenge 2 Soon"); }
        function goToChallenge3() { alert("Challenge 3 Soon"); }
        function goToPrize() { alert("Prize Soon"); }

    </script>
</body>
</html>
